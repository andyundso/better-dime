{% extends 'pdfs/static/effort_reports' %}

{% block title %}
    <title>Aufwandsrapport_{{ invoice.id }}_{{ invoice.name | split(',') | first | split(';') | first |
        replace({'ä': 'ae', 'ö': 'oe', 'ü': 'ue', 'Ä': 'Ae', 'Ö': 'Oe', 'Ü': 'Ue', ' ': '_', ':': '', ';': '', '.': ''})}}_{{ "now"|date("Y_m_d") }}</title>
{% endblock %}

{% block content %}
    <div class="header clear-float">
        <div class="offer-title">
            <b>Aufwandsrapport: {{ invoice.name }}</b>
        </div>
    </div>

    <div class="margin-top">
        <b>Rechnung Nr. {{ invoice.id }}</b><br/><br/>
        <b>Zusammenfassung:</b><br/>
        {{ description | raw }}
    </div>

    <div class="margin-top report-area">
        <div class="float-left bold first-column padding-right">
            Bezeichnung
        </div>
        <div class="float-left bold text-align-right additional-columns padding-right">
            Anzahl
        </div>
        <div class="float-left bold additional-columns padding-right">
            Einheit
        </div>
        <br>
        <hr>
        <br>
        {% for date, items in content %}
            <div class="avoid-page-break">
                <div class=bold">Tag: {{ date|date("d.m.Y") }}</div>
                <br>
                {% for comment in items.comments %}
                    <div class="italic padding-right">{{ comment.comment }}</div>
                {% endfor %}
                {% for effort in items.efforts %}
                    <div class="clear-float">
                        <div class="float-left first-column padding-right">
                            {% if effort.position_description is empty %}
                                {{ effort.service_name }}
                                {% if effort.is_ambiguous %}
                                    {% if effort.group_name is not null %}
                                        [{{ effort.group_name }}]
                                    {% else %}
                                        [Generell]
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                {{ effort.position_description }}
                            {% endif %}
                        </div>
                        <div class="float-left text-align-right additional-columns padding-right">
                            {{ (effort.effort_unit_is_time ? (effort.efforts_sum / effort.effort_unit_factor) : effort.efforts_sum) | round(2) }}
                        </div>
                        <div class="float-left additional-columns padding-right">
                            {{ effort.effort_unit_name }}
                        </div>
                    </div>
                {% endfor %}
                <br>
                <hr>
                <br>
            </div>
        {% endfor %}
    </div>
{% endblock %}
