{% extends 'pdfs/static/base' %}

{% block title %}
    <title>Rechnung {{ invoice.id }} zum Projekt {{ invoice.project.id }} vom {{ "now"|date("d.m.Y") }}</title>
{% endblock %}

{% block customer %}
    <div class="clear-float">
        <div class="recipient-address float-right">
            {{ addressLabel | raw }}
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="header clear-float">
        <div>
            {{ env('SENDER_CITY') }}, {{ "now"|date("d.m.Y") }}
        </div>

        <div>
            Sachbearbeiter: {{ invoice.accountant.first_name ~ ' ' ~ invoice.accountant.last_name }}
        </div>

        <div class="offer-title">
            <b>Rechnung:<br>{{ invoice. name }}</b>
        </div>

        <table class="top_table">
            <tr>
                <td width="30%">Rechnung Nr. {{ invoice.id }}</td>
                {% if invoice.offer %}
                    <td width="30%">Offerte Nr. {{ invoice.offer.id }}</td>
                {% endif %}
                <td>MwSt.-ID {{ env('SENDER_MWST') }}</td>
            </tr>
            <tr>
                {% if invoice.project %}
                    <td width="20%">Projekt Nr. {{ invoice.project.id }}</td>
                {% endif %}
                <td colspan="2">Kostenstellen {% for dist in invoice.distribution_of_costgroups %}
                        {{ dist.ratio }}% {{ dist.costgroup_number }}
                    {% endfor %}
                </td>
            </tr>
        </table>

        {% if invoice.start and invoice.end %}
            Aufwandzeitraum {{ invoice.start|date('d.m.Y') }} - {{ invoice.end|date('d.m.Y') }}
        {% endif %}

        {% if description %}
            <div class="description">
                {{ description | raw }}
            </div>
        {% endif %}
    </div>

    {{ tableGen(
        {
            "table": {
            "class": "table"
        },
            "tfoot-tr": {
            "class": "bold-cells"
        }
        },
        {
            "Bezeichnung": {"attr": { "class": "first-row" }},
            "Ansatz CHF": {"attr": { "class": "second-row text-align-right" }},
            "Einheit": {"attr": { "class": "third-row" }},
            "Anzahl": {"attr": { "class": "fourth-row" }},
            "MwSt. Satz": {"attr": { "class": "fifth-row text-align-right" }},
            "Teilbetrag CHF exkl. MwSt.": {"attr": { "class": "sixth-row text-align-right" }}
        },
        breakdown.positions,
        {
            "description": {},
            "price_per_rate": {"attr": {"class": "text-align-right"}, "format": "chf"},
            "rate_unit.billing_unit": {},
            "amount": {},
            "vat": {"attr": {"class": "text-align-right"}, "format": "percent"},
            "calculated_total": {"attr": {"class": "text-align-right" }, "format": "chf"}
        },
        [
            {
                "Subtotal": {"attr": {"colspan": "5" }},
                (breakdown.subtotal): {"format": "chf", "attr": {"class": "text-align-right"}}
            }
        ]
    ) }}

    {% if breakdown.discounts is not empty %}
        {{ tableGen(
            {
                "table": {
                "class": "table",
                "style": "margin-top: 30px;"
            },
                "tfoot-tr-1": {
                "class": "bold-cells"
            }
            },
            {
                "Abzug": {"attr": { "colspan": "5" }},
                "Betrag CHF": {"attr": { "class": "sixth-row text-align-right" }}
            },
            breakdown.discounts,
            {
                "name": {"attr": {"colspan": "5"}},
                "value": {"attr": {"class": "text-align-right"}, "format": "chf"},
            },
            [
                {
                    "Abz√ºge Total": {"attr": {"colspan": "5" }},
                    (breakdown.discountTotal): {"format": "chf", "attr": {"class": "text-align-right"}}
                },
                {
                    "Subtotal": {"attr": {"colspan": "5"}},
                    (breakdown.rawTotal): {"format": "chf", "attr": {"class": "text-align-right"}}
                }
            ]
        ) }}
    {% endif %}

    {{ tableGen(
        {
            "table": {
            "class": "table",
            "style": "margin-top: 30px;"
        },
            "tfoot-tr-1": {
            "class": "bold-cells"
        }
        },
        {
            "MwSt. Satz": {"attr": { "colspan": "5"}},
            "Betrag CHF": {"attr": { "class": "sixth-row text-align-right" }}
        },
        breakdown.vats,
        {
            "vat": {"attr": {"colspan": "5"}, "format": "percent"},
            "value": {"attr": {"class": "text-align-right"}, "format": "chf"},
        },
        [
            {
                "Mehrwertsteuer Total": {"attr": {"colspan": "5"}},
                (breakdown.vatTotal): {"format": "chf", "attr": {"class": "text-align-right"}}
            },
            {
                "Rechnungstotal": {"attr": {"colspan": "5" }},
                (breakdown.total): {"format": "chf", "attr": {"class": "text-align-right"}}
            }
        ]
    ) }}
{% endblock %}


